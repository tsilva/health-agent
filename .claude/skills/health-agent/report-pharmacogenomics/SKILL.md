---
name: report-pharmacogenomics
description: Generate pharmacogenomics report section for provider visits. Use when user asks "pharmacogenomics report for doctor", "medication genetics for provider", "PGx report for appointment", or needs a saveable pharmacogenomics document for healthcare providers.
---

# Report: Pharmacogenomics Summary

Generate a standardized pharmacogenomics section suitable for provider visits and medical records.

## Purpose

This report section provides:
- Current metabolizer status for key drug-metabolizing enzymes
- Specific medication implications
- Format optimized for sharing with healthcare providers
- Actionable recommendations with appropriate caveats

## Prerequisites

- Profile must have `genetics_23andme_path` configured
- Uses `genetics-snp-lookup` skill for all SNP interpretations

## Workflow

1. Load profile and extract `genetics_23andme_path`
2. **Delegate to genetics-snp-lookup**: Call for all pharmacogenomics genes (CYP2D6, CYP2C19, CYP2C9, VKORC1, SLCO1B1, TPMT, DPYD)
3. Receive metabolizer statuses and medication implications from genetics-snp-lookup
4. Format into standardized provider-ready section
5. Save to `.output/{profile}/sections/pharmacogenomics-{date}.md`

## Calling genetics-snp-lookup

Use genetics-snp-lookup in **gene-based pharmacogenomics mode**:

```
For each gene in [CYP2D6, CYP2C19, CYP2C9, VKORC1, SLCO1B1, TPMT, DPYD]:
  Call genetics-snp-lookup with: "look up {gene} pharmacogenomics"

genetics-snp-lookup will:
1. Query SNPedia for gene's clinically relevant rsIDs
2. Extract those SNPs from 23andMe data
3. Fetch interpretations from SNPedia
4. Return metabolizer status, affected drugs, dosing guidance
```

**Do NOT**:
- Duplicate SNP extraction logic
- Hardcode rsID lists
- Reimplement metabolizer status determination
- Query SNPedia directly

genetics-snp-lookup is the centralized lookup mechanism - this skill focuses on formatting for providers.

## Output Format

The section must follow this exact format for composability:

```markdown
---
section: pharmacogenomics
generated: {YYYY-MM-DD}
source: 23andMe raw data (consumer genetic test)
profile: {profile_name}
---

# Pharmacogenomics Summary

## Metabolizer Status Summary

| Gene | Status | Key Implications |
|------|--------|------------------|
| CYP2D6 | {status from genetics-snp-lookup} | {brief implication} |
| CYP2C19 | {status from genetics-snp-lookup} | {brief implication} |
| CYP2C9 | {status from genetics-snp-lookup} | {brief implication} |
| VKORC1 | {status from genetics-snp-lookup} | {brief implication} |
| SLCO1B1 | {status from genetics-snp-lookup} | {brief implication} |
| TPMT | {status from genetics-snp-lookup} | {brief implication} |
| DPYD | {status from genetics-snp-lookup} | {brief implication} |

---

## Medications Requiring Attention

### Medications to Use with Caution

| Drug Class | Examples | Reason | Recommendation |
|------------|----------|--------|----------------|
| {class} | {examples} | {your status} | {action from genetics-snp-lookup} |

### Medications with No Genetic Concerns Detected

Standard dosing expected for medications metabolized by pathways with normal status.

---

## Detailed Genotypes

| Gene | SNP | Genotype | Interpretation |
|------|-----|----------|----------------|
| CYP2D6 | rs3892097 | {genotype} | {allele from genetics-snp-lookup} |
| CYP2D6 | rs1065852 | {genotype} | {allele from genetics-snp-lookup} |
| CYP2C19 | rs4244285 | {genotype} | {allele from genetics-snp-lookup} |
| CYP2C19 | rs12248560 | {genotype} | {allele from genetics-snp-lookup} |
| CYP2C9 | rs1799853 | {genotype} | {allele from genetics-snp-lookup} |
| CYP2C9 | rs1057910 | {genotype} | {allele from genetics-snp-lookup} |
| VKORC1 | rs9923231 | {genotype} | {sensitivity from genetics-snp-lookup} |
| SLCO1B1 | rs4149056 | {genotype} | {transport from genetics-snp-lookup} |
| TPMT | rs1800460 | {genotype} | {activity from genetics-snp-lookup} |
| TPMT | rs1142345 | {genotype} | {activity from genetics-snp-lookup} |
| DPYD | rs3918290 | {genotype} | {activity from genetics-snp-lookup} |

---

## Provider Notes

1. **Copy number variations**: CYP2D6 gene duplications/deletions are NOT detected by this test
2. **CPIC Guidelines**: For formal dosing recommendations, consult CPIC (cpicpgx.org)
3. **Consumer test**: Confirm with clinical testing for critical medication decisions
4. **Data source**: Interpretations from SNPedia (genetics-snp-lookup skill with 30-day cache)

---

**Cross-Reference**: See Medication List section for current medications.

---
*Section generated by health-agent report-pharmacogenomics skill*
```

## Output File

- **Directory**: `.output/{profile}/sections/`
- **Filename**: `pharmacogenomics-YYYY-MM-DD.md`
- **Create directory if needed**: `mkdir -p .output/{profile}/sections`

**IMPORTANT**: Use the `Write` tool to create the report file, NOT Bash heredocs/redirects. Bash file writing (`cat > file` or heredocs) is blocked by sandbox restrictions. Directory creation via `mkdir -p` is permitted.

## Section Header Requirements

For composability with other report sections:
1. Include YAML frontmatter with section name, date, source, and profile
2. Use consistent H1 header format
3. End with horizontal rule and attribution line
4. Tables must be valid markdown for concatenation

## Provider-Friendly Formatting

- Use medical terminology appropriate for healthcare providers
- Include actionable recommendations
- Emphasize limitations clearly
- Provide genotype data for their records
- Reference CPIC for clinical guidelines
- Note data source and caching (SNPedia via genetics-snp-lookup)

## Metabolizer Status Categories

genetics-snp-lookup returns these statuses from SNPedia:

| Status | Description |
|--------|-------------|
| Normal Metabolizer | Standard drug metabolism expected |
| Intermediate Metabolizer | Reduced metabolism; may need dose adjustment |
| Poor Metabolizer | Significantly reduced; major dosing changes or alternatives |
| Ultra-rapid Metabolizer | Increased metabolism; may need higher doses or alternatives |
| Increased Sensitivity | (VKORC1) Lower warfarin doses needed |

## Combining with Other Reports

This section is designed to combine with:
- `report-medication-list` - Current medications
- `report-genetic-risks` - Health risk variants

Combined report for provider visit:
1. Medication list + pharmacogenomics = comprehensive medication review
2. All genetics sections = complete genetic summary

## Integration with Other Skills

- **genetics-pharmacogenomics**: Non-report version for interactive analysis
- **report-medication-list**: Shows current medications (combine for complete picture)
- **report-genetic-risks**: Companion genetics report section

## Notes

- All SNP interpretations come from SNPedia via genetics-snp-lookup (cached, 30-day TTL)
- genetics-snp-lookup handles SNP extraction, API calls, caching, and error handling
- This skill focuses on formatting for provider consumption and saving to .output/
- For interactive pharmacogenomics analysis, use the genetics-pharmacogenomics skill
